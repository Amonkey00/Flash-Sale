# Flash-Sale
A personal flash-sale project for practice



# 1 项目简介

​	Flash-Sale项目是一个模拟实现商城秒杀的项目，用于练习处理高并发，高可用性的后端架构设计。

该项目在主流的商城秒杀项目基础上，加入当前一些主流的维持高可用性的通用办法，对整个后端开发流程进行练习。

参考博客https://blog.csdn.net/weixin_42687829/article/details/104535027：

**相关要点**

- 使用分布式Session，实现让多台服务器可同时响应。
- 使用Redis作为缓存，提高访问速度和并发量，利用内存标记减少Redis的访问次数
- 使用消息队列异步完成下单，在消息队列进出处设立拦截器，提前将完全不符合条件（即已经能够判断操作无效的）操作进行剔除，实现降级过滤，减少数据库压力。

- 页面静态化处理，用Redis进行缓存短时间内渲染的前端html，提高QPS，并将页面缓存至前端
- 安全性优化：秒杀接口地址的隐藏，接口限流防刷。

- 利用数据库特性 指 update xxx where stock > 0 进行判断，防止超卖现象

**技术栈**

- 前端：无
- 后端：SpringBoot、MyBatis
- 中间件：RocketMq、Redis

**后续考虑**

可能能够应用一些RPC框架，构建普通应用

# 2 项目设计

## 2.1 数据库设计

**用户表 User**

|   名称   | 字段名 |       类型        |                   描述                   |
| :------: | :----: | :---------------: | :--------------------------------------: |
|  用户ID  |  u_id  | INT, NOT NULL, PK |        用户的唯一ID标识每一个用户        |
|  用户名  | u_name |    Varchar(40)    |       用户的唯一昵称，可以自主设定       |
| 手机号码 | phone  |    Varchar(20)    |                用户手机号                |
|   邮箱   | email  |    Varchar(48)    |                 用户邮箱                 |
| 账户余额 | wallet |   Demical(12,2)   | 用户的剩余钱数(<=1e10)，精度保留两位小数 |

**商品表Product**

|   名称   |    字段名    |       类型        |          描述          |
| :------: | :----------: | :---------------: | :--------------------: |
|  商品ID  |     p_id     | INT, NOT NULL, PK | 商品的唯一ID，自增主键 |
| 商品名称 |    p_name    |    Varchar(40)    |     商品的显示名称     |
| 商品图片 |    image     |   Varchar(128)    |     商品的图片url      |
| 商品简介 | introduction |   Varchar(128)    |     商品相关的介绍     |
|   价格   |    price     |   Demical(12,2)   |        商品单价        |
|   库存   | stock_count  |        INT        |     商品库存剩余量     |
| 秒杀标签 |     flag     |      Boolean      |  该商品是否为秒杀商品  |
| 开始时间 |  start_time  |       Date        |  商品抢购预设开始时间  |
| 结束时间 |   end_time   |       Date        |  商品抢购预设结束时间  |

**订单表Order**

|   名称   |   字段名    |       类型        |                           描述                           |
| :------: | :---------: | :---------------: | :------------------------------------------------------: |
|  订单ID  |    o_id     | INT, NOT NULL, PK |                      订单的唯一ID号                      |
|  买家ID  |    u_id     |      INT, FK      |                        买家的ID号                        |
|  商品ID  |    p_id     |      INT, FK      |                        商品的ID号                        |
| 购买数量 |   number    |        INT        |                     当前订单购买数量                     |
| 创建时间 | create_time |       Date        |                      订单创建的时间                      |
| 订单状态 |   status    |    Varchar(2)     | 标明当前订单的状态：[AC订单完成\|WT等待支付\|FN订单取消] |

**支付记录 Record**

|   名称   |   字段名    |  类型   |                       描述                       |
| :------: | :---------: | :-----: | :----------------------------------------------: |
|  记录ID  |    r_id     | INT, PK |                 支付记录的唯一ID                 |
|  订单ID  |    o_id     | INT, FK |                   关联订单的ID                   |
|  用户ID  |    u_id     | INT, FK | 买家用户ID，用于快速查询支付记录，以及退款操作。 |
|  商品ID  |    p_id     | INT, FK |  支付商品ID, 用于后续统计支付成功后的数量，以及  |
| 创建时间 | create_time |  Date   |        支付记录的创建时间，即成功支付时间        |
